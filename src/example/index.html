<!DOCTYPE html>
<html>
<head>
    <!-- Title can't be set via Knockout, at least not out-of-the-box -->
    <title></title>

    <!-- Load dependencies -->
    <script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/require.js/2.1.11/require.min.js"></script>
    <link rel="stylesheet" type="text/css" href="http://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.1.1/css/bootstrap.min.css" media="all" />
    <link rel="stylesheet" type="text/css" href="css/simon.css" media="all" />
    <!-- load configuration -->
    <script type="text/javascript" src="config.js"></script>

    <!-- bootstrap application -->
    <script type="text/javascript">
        requirejs.config({
            waitSeconds: 0,
            baseUrl : "./js",
            name: './Application',
            paths: {
                'Application': 'simon.min',
                'jquery': 'http://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.0/jquery.min',
                'knockout': 'http://cdnjs.cloudflare.com/ajax/libs/knockout/3.1.0/knockout-min',
                'moment': 'http://cdnjs.cloudflare.com/ajax/libs/moment.js/2.5.1/moment.min',
                'bootstrap': 'http://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.1.1/js/bootstrap.min'
            },
            shim: {
                'bootstrap': {
                    deps: ['jquery']
                },
                'Application': {
                    deps: ['jquery','knockout','moment']
                }
            },
            findNestedDependencies: true
        });

        //initialize application
        require(['Application', 'knockout', 'jquery', 'bootstrap'], function(ApplicationViewModel, ko) {
            ko.applyBindings(new ApplicationViewModel('config.json'));
        });
    </script>

    <!-- template definitions -->
    <script type="text/html" id="application-template">
        <!-- ko if: isLoading() -->
        <div>
            <p>loading configuration...</p>
        </div>
        <!-- /ko -->
        <!-- ko if: getFailureText() -->
        <div>
            <p data-bind="text: getFailureText()"></p>
        </div>
        <!-- /ko -->

        <!-- CSS files should not be linked in the body, but Knockout doesn't support bindings in the HTML head out-of-the-box. -->
        <!-- ko if: $root.getCustomCss() -->
        <link data-bind="attr: {href: $root.getCustomCss()}" rel="stylesheet" type="text/css" media="all" />
        <!-- /ko -->

        <!-- ko if: getTitle() -->
        <h1 id="mainTitle" class="alert alert-none monitor-heading" data-bind="text: getTitle()"></h1>
        <!-- /ko -->
        <div id="container-fluid" data-bind="template: { name: 'section-row-template', foreach: getSections() }" ></div>
    </script>
    <script type="text/html" id="section-row-template">
        <!-- ko if: getTitle() -->
        <div class="row">
            <div class="col-lg-12">
                <!-- ko if: getTitle() -->
                <h2 class="alert alert-none monitor-heading">
                    <!-- ko if: getUrl() -->
                    <a class="alert-link monitor-link" data-bind="attr: { href: getUrl(), title: getTitle() }, text: getTitle()"></a>
                    <!-- /ko -->
                    <!-- ko ifnot: getUrl() -->
                    <span data-bind="text: getTitle()"></span>
                    <!-- /ko -->
                </h2>
                <!-- /ko -->
                <!-- ko if: getDescription() -->
                <p class="section-description" data-bind="html: getDescription()"></p>
                <!-- /ko -->
            </div>
        </div>
        <!-- /ko -->
        <!-- ko if: getSections().length > 0 -->
        <div class="row">
            <!-- ko template: { name: 'section-column-template', foreach: getSections() } -->
            <!-- /ko -->
        </div>
        <!-- /ko -->
    </script>
    <script type="text/html" id="section-column-template">
        <div data-bind="css: 'col-lg-'+$parent.getColumnWidth()">
            <!-- ko if: getTitle() -->
            <h3 class="alert alert-none monitor-heading">
                <!-- ko if: getUrl() -->
                <a class="alert-link monitor-link" data-bind="attr: { href: getUrl(), title: getTitle() }, text: getTitle()"></a>
                <!-- /ko -->
                <!-- ko ifnot: getUrl() -->
                <span data-bind="text: getTitle()"></span>
                <!-- /ko -->
            </h3>
            <!-- /ko -->
            <!-- ko if: getDescription() -->
            <p class="section-description" data-bind="html: getDescription()"></p>
            <!-- /ko -->
            <!-- ko if: getMonitorModels().length > 0 -->
            <div class="panel-group" data-bind="template: { name: 'monitor-template', foreach: getMonitorModels(), afterRender: $root.getData }"></div>
            <!-- /ko -->
            <!-- ko if: getSections().length > 0 -->
            <!-- ko template: { name: 'section-row-template', foreach: getSections() } -->
            <!-- /ko -->
            <!-- /ko -->
        </div>
    </script>
    <script type="text/html" id="monitor-template">
        <!-- ko if: $root.getTypes().isJenkins(getType()) -->
        <div class="panel panel-default">
            <div class="alert-none">
                <a class="detail-link" data-toggle="collapse" data-bind="attr: { href: '#' + getHtmlsafeId() + $index(), title: getName() }">
                    <div data-bind='attr: {style: getStyle()}, css: getCss()'>
                        <span class="detail-name" data-bind="text: getName()"></span><br/>
                        <!-- ko if: getBuildingStyle() -->
                        <div class="progress progress-striped active">
                            <div data-bind='attr: {style: "width: "+getCompletedPercent()+"%", "aria-valuenow": getCompletedPercent() }, css: getBuildingStyle()' role="progressbar" aria-valuemin="0" aria-valuemax="100"></div>
                        </div>
                        <!-- /ko -->
                    </div>
                </a>
            </div>
            <div class="panel-collapse collapse" data-bind="attr: { id: getHtmlsafeId() + $index() }">
                <!-- ko template: { name: 'jenkins-detail-model-template', data: getDetails() } -->
                <!-- /ko -->
            </div>
        </div>
        <!-- /ko -->
        <!-- ko if: $root.getTypes().isNagios(getType()) -->
        <h3 class="monitor-heading" data-bind="text: getName()"></h3>
        <div data-bind="template: { name: 'nagios-hostmodel-template', foreach: getHostmodels() }"></div>
        <!-- /ko -->
        <!-- ko if: $root.getTypes().isSonar(getType()) -->
        <div data-bind="template: { name: 'sonar-monitormodel-template' }"></div>
        <!-- /ko -->
    </script>
    <script type="text/html" id="jenkins-detail-model-template">
        <dl class="jenkins-details-link">
            <dt>Job on Jenkins</dt>
            <dd><a class="monitor-link" data-bind="attr: { href: getUrl() }, text: getName()"></a></dd>
        </dl>
        <dl class="jenkins-details-build-number">
            <dt>Build number</dt>
            <dd><a class="monitor-link" data-bind="attr: { href: getBuildNumberUrl() }, text: 'Build #' + getBuildNumber()"></a></dd>
        </dl>
        <!-- ko if: getCommitHash() !== undefined -->
        <dl class="jenkins-details-commit-hash">
            <dt>Commit Hash</dt>
            <dd data-bind="text: getCommitHash()"></dd>
        </dl>
        <!-- /ko -->
        <!-- ko if: getBranchName() !== undefined -->
        <dl class="jenkins-details-branch">
            <dt>Branch</dt>
            <dd data-bind="text: getBranchName()"></dd>
        </dl>
        <!-- /ko -->
        <dl class="jenkins-details-start-time">
            <dt>Start Time</dt>
            <dd data-bind="text: getStartDate()"></dd>
        </dl>
        <dl class="jenkins-details-run-time">
            <dt>Run Time</dt>
            <dd data-bind="text: getRunTime()"></dd>
        </dl>
    </script>
    <script type="text/html" id="nagios-hostmodel-template">
        <div class="panel panel-default">
            <a class="detail-link" data-toggle="collapse" data-bind="attr: { href: '#' + getHostname() + $index(), title: getHostname() }">
                <div data-bind="css: getCss()">
                    <span class="detail-name" data-bind="text: getHostname()"></span><br/>
                    <ul data-bind="foreach: getBrokenServices()" style="list-style-type: none; padding:0; margin:0;" class="nagios-broken-services">
                        <li><span data-bind="text: $data"></span></li>
                    </ul>
                </div>
            </a>
            <div class="panel-collapse collapse" data-bind="attr: { id: getHostname() + $index() }">
                <dl class="nagios-link">
                    <dt>Nagios:</dt>
                    <dd><a class="alert-link monitor-link" data-bind="attr: { href: getUrl(), title: getHostname() }, text: getHostname()"></a></dd>
                </dl>
                <dl class="nagios-all-services">
                    <dt>All services:</dt>
                    <dd>
                        <ul data-bind="foreach: getAllServices()" style="list-style-type: none; padding:0; margin:0;">
                            <li><span data-bind="text: $data"></span></li>
                        </ul>
                    </dd>
                </dl>
            </div>
        </div>
    </script>
    <script type="text/html" id="sonar-monitormodel-template">
        <h4 class="monitor-heading"><a class="alert-link monitor-link" data-bind="attr: { href: getUrl(), title: getName() }, text: getName()"></a></h4>
        <table class="codeviolations">
            <thead>
            <tr>
                <th>Blocker</th>
                <th>Critical</th>
                <th>Major</th>
                <th>Minor</th>
                <th>Info</th>
                <th></th>
            </tr>
            </thead>
            <tbody data-bind="foreach: getViolationModels()"><tr data-bind="template: {name: 'sonar-violation-template', foreach: getViolations()}"></tr></tbody>
        </table>
    </script>
    <script type="text/html" id="sonar-violation-template">
        <td class="sonar-violation-count"><div data-bind="css: getCss(), text: getCount()"></div></td>
        <!-- ko if: ($index() === ($parent.getViolations().length - 1)) -->
        <th class="sonar-module-name"><a data-bind="attr: { href: $parent.getUrl(), title: $parent.getName() }, text: $parent.getName()"></a></th>
        <!-- /ko -->
    </script>
</head>
<body>
    <div id="wrapper" data-bind="template : {name: 'application-template'}">
        <!-- Render application in this wrapper element. -->
    </div>
</body>
</html>