<!DOCTYPE html>
<html>
<head>
    <title></title>
    <script type="text/javascript" data-main="./app/Application" src="js/vendor/require.js"></script>
    <script type="text/javascript" src="js/vendor/jquery-2.1.0.min.js"></script>
    <script type="text/javascript" src="js/vendor/bootstrap.min.js"></script>
    <script type="text/javascript" src="config.js"></script>
    <link rel="stylesheet" type="text/css" href="css/vendor/bootstrap.min.css" media="all" />
    <link rel="stylesheet" type="text/css" href="css/bootstrap-theme-monitor.css" media="all" />
    <meta http-equiv="refresh" content="600">
</head>
<body>

<script type="text/javascript">
    requirejs.config({
        paths: {
            'jquery': '../js/vendor/jquery-2.1.0.min',
            'knockout': '../js/vendor/knockout-3.1.0',
            'moment': '../js/vendor/moment-with-langs.min'
        }
    });

    //initialize application
    require(['Application', 'knockout', 'jquery'], function(ApplicationViewModel, ko) {
        var applicationViewModel = new ApplicationViewModel(json);
        ko.applyBindings(applicationViewModel);
        jQuery.fx.interval = 40;
    });
</script>

<div id="wrapper" data-bind="template : {name: 'application-template'}"></div>

<script type="text/html" id="application-template">
    <link data-bind="attr: {href: $root.getThemeCss()}" rel="stylesheet" type="text/css" media="all" />
    <link data-bind="attr: {href: $root.getCustomCss()}" rel="stylesheet" type="text/css" media="all" />

    <!-- ko if: getTitle() -->
    <h1 id="mainTitle" class="alert alert-info monitor-header" data-bind="text: getTitle()"></h1>
    <!-- /ko -->
    <div id="container-fluid" data-bind="template: { name: 'section-row-template', foreach: getSections() }" ></div>
</script>

<script type="text/html" id="section-row-template">
    <div class="row">
        <div class="col-lg-12">
            <!-- ko if: getTitle() -->
            <h2 class="alert alert-none monitor-header">
                <!-- ko if: getUrl() -->
                <a class="alert-link monitor-link" data-bind="attr: { href: getUrl(), title: getTitle() }, text: getTitle()"></a>
                <!-- /ko -->
                <!-- ko ifnot: getUrl() -->
                <span data-bind="text: getTitle()"></span>
                <!-- /ko -->
            </h2>
            <!-- /ko -->
            <!-- ko if: getDescription() -->
            <p class="section-description" data-bind="html: getDescription()"></p>
            <!-- /ko -->
        </div>
    </div>
    <div class="row">
        <!-- ko if: getSections().length > 0 -->
        <!-- ko template: { name: 'section-template', foreach: getSections() } -->
        <!-- /ko -->
        <!-- /ko -->
    </div>
</script>

<script type="text/html" id="section-template">
    <div data-bind="css: 'col-lg-'+$parent.getColumnWidth()">
        <!-- ko if: getTitle() -->
        <h2 class="alert alert-none monitor-header">
            <!-- ko if: getUrl() -->
            <a class="alert-link monitor-link" data-bind="attr: { href: getUrl(), title: getTitle() }, text: getTitle()"></a>
            <!-- /ko -->
            <!-- ko ifnot: getUrl() -->
            <span data-bind="text: getTitle()"></span>
            <!-- /ko -->
        </h2>
        <!-- /ko -->
        <!-- ko if: getDescription() -->
        <p class="section-description" data-bind="html: getDescription()"></p>
        <!-- /ko -->
        <!-- ko if: getMonitorModels().length > 0 -->
        <div class="panel-group small-block" data-bind="template: { name: 'monitor-template', foreach: getMonitorModels(), afterRender: $root.getData }"></div>
        <!-- /ko -->
    </div>
</script>

<script type="text/html" id="monitor-template">
    <!-- ko if: $root.getTypes().isJenkins(getType()) -->
    <div class="panel panel-default">
        <div data-bind="attr: {style: getStyle()}, css: getCss(), pulsate: getCss()">
            <a class="alert-link monitor-link" data-toggle="collapse" data-bind="attr: { href: '#' + getId() + $index(), title: getName() }, text: getName()"></a><br/>
            <span class="jenkins-start-date" data-bind="text: getStartDate()"></span>
        </div>
        <div class="panel-collapse collapse" data-bind="attr: { id: getId() + $index() }">
            <dl class="jenkins-details-build-number">
                <dt>Build number</dt>
                <dd><a class="monitor-link" data-bind="attr: { href: getBuildNumberUrl() }, text: 'Build #' + getBuildNumber()"></a></dd>
            </dl>
            <!-- ko if: getCommitHash() !== undefined -->
            <dl class="jenkins-details-commit-hash">
                <dt>Commit Hash</dt>
                <dd data-bind="text: getCommitHash()"></dd>
            </dl>
            <!-- /ko -->
            <!-- ko if: getBranchName() !== undefined -->
            <dl class="jenkins-details-branch">
                <dt>Branch</dt>
                <dd data-bind="text: getBranchName()"></dd>
            </dl>
            <!-- /ko -->
            <dl class="jenkins-details-start-time">
                <dt>Start Time</dt>
                <dd data-bind="text: getStartDate()"></dd>
            </dl>
            <dl class="jenkins-details-run-time">
                <dt>Run Time</dt>
                <dd data-bind="text: getRunTime()"></dd>
            </dl>
        </div>
    </div>
    <!-- /ko -->
    <!-- ko if: $root.getTypes().isNagios(getType()) -->
    <h3 class="monitor-header" data-bind="text: getName()"></h3>
    <div data-bind="template: { name: 'nagios-hostmodel-template', foreach: getHostmodels() }"></div>
    <!-- /ko -->
    <!-- ko if: $root.getTypes().isSonar(getType()) -->
    <div data-bind="template: { name: 'sonar-monitormodel-template' }"></div>
    <!-- /ko -->
</script>

<script type="text/html" id="nagios-hostmodel-template">
    <div class="panel panel-default">
        <div data-bind="css: getCss()">
            <a class="alert-link monitor-link" data-bind="attr: { href: getUrl(), title: getHostname() }, text: getHostname()"></a><br/>
            <span data-bind="html: getText()"></span>
        </div>
    </div>
</script>

<script type="text/html" id="sonar-monitormodel-template">
    <h3 class="monitor-header"><a class="alert-link monitor-link" data-bind="attr: { href: getUrl(), title: getName() }, text: getName()"></a></h3>
    <table class="codeviolations">
        <thead>
        <tr>
            <th>Blocker</th>
            <th>Critical</th>
            <th>Major</th>
            <th>Minor</th>
            <th>Info</th>
            <th></th>
        </tr>
        </thead>
        <tbody data-bind="foreach: getViolationModels()"><tr data-bind="template: {name: 'sonar-violation-template', foreach: getViolations()}"></tr></tbody>
    </table>
</script>

<script type="text/html" id="sonar-violation-template">
    <td class="sonar-violation-count"><div data-bind="css: getCss(), text: getCount()"></div></td>
    <!-- ko if: ($index() === ($parent.getViolations().length - 1)) -->
    <th class="sonar-module-name"><a data-bind="attr: { href: $parent.getUrl(), title: $parent.getName() }, text: $parent.getName()"></a></th>
    <!-- /ko -->
</script>
</body>
</html>